<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funcionário</title>
    <link REL="SHORTCUT ICON" HREF="../assets/imagens/Logo_Quadrada-removebg.png">
    <link rel="stylesheet" href="css/decisao.css">
</head>

<body>
    <div class="header">
        <div class="imagem1">
            <img src="../assets/imagens/logo.svg" class="imagemfixa">
        </div>
        <div class="opcPrincipais">
            <a href="principal-cadastrado.html">Home</a>
            <a href="orcamento-cadastrado.html">Orçamentos</a>
            <a href="decisao-dashbord.html">Painel</a>
        </div>
        <div class="cadastro2">
            <a href="decisao.html"> Voltar</a>
        </div>
    </div>
    <div class="tudoF">
        <div class="cardF">
            <div>
                <p class="tituloFunc">Funcionário</p>
            </div>

            <div class="teste">
                <div class="preguntasFunc">
                    <div>
                        <p class="perguntas">Nome do funcionário</p>
                        <input type="text" id="input_nomeFunc" autocomplete="off">
                    </div>

                    <div>
                        <p class="perguntas">E-mail</p>
                        <input type="text" id="input_emailFunc" autocomplete="off">

                    </div>



                    <div>
                        <p class="perguntas">Cargo do funcionário</p>
                        <input type="text" id="input_cargo" autocomplete="off">
                    </div>


                </div>

                <div class="preguntasFunc2">
                    <div>
                        <p class="perguntas">Senha</p>
                        <input type="text" id="input_senhaFunc" autocomplete="off">
                    </div>

                    <div>
                        <p class="perguntas">Telefone do funcionário</p>
                        <input type="number" id="input_telefone" autocomplete="off">
                    </div>

                    <div>
                        <p class="perguntas">Id do Estabelecimento</p>
                        <input type="number" id="input_nomeEstFuncTrab" autocomplete="off">
                    </div>
                </div>

            </div>





            <div>
                <button class="botaoFF" onclick="cadastrarFuncionario()">Cadastrar Funcionário</button>
            </div>
            <div>
                <p>Deseja cadastrar um Estabelecimento? <span class="cliqueAqui" onclick="estabelecimento()">Clique
                        aqui</span></p>
            </div>
        </div>
        <div class="imagemPergunta">
            <img src="../assets/imagens/30576701_7718877-ai-brush-removebg-7g7bvysh.png" alt="" class="imagemPergunta">
        </div>
    </div>
</body>

</html>
<script src="./js/sessao.js"></script>
<script>
    window.load = Autenticar_Usuario(sessionStorage.NOME_USUARIO, sessionStorage.EMAIL_USUARIO, sessionStorage.ID_USUARIO);

    function cadastrarFuncionario() {
        var verificacao = false;

        var nomeFunc = input_nomeFunc.value;
        var cargo = input_cargo.value;
        var telefone = input_telefone.value;
        var email = input_emailFunc.value;
        var senha = input_senhaFunc.value;
        var fkcliente = sessionStorage.ID_USUARIO;
        var ultimo_funcionario = 0;

        if (nomeFunc != '' && cargo != '' && telefone != '' && email != '' && senha != '') {
          

            console.log(ultimo_funcionario)

            fetch("/usuarios/cadastrar_funcionario", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeFuncServer: nomeFunc,
                    cargoServer: cargo,
                    telefoneServer: telefone,
                    emailServer: email,
                    senhaServer: senha,
                    idClienteServer: fkcliente
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        cardErro.style.display = "block";

                        mensagem_erro.innerHTML =
                            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                        // setTimeout(() => {
                        //     window.location = "decisao.html";
                        // }, "2000");


                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);

                });

            alert('Funcionário cadastrado com sucesso!');
            verificacao = true;
        }
    }
    function estabelecimento() {
        window.location.href = 'telaEst.html';
    }
</script>