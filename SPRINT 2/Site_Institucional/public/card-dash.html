<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards Dashboard</title>
    <link REL="SHORTCUT ICON" HREF="../assets/imagens/Logo_Quadrada-removebg.png">
    <link rel="stylesheet" href="css/dashboard.css">
</head>

<body>
    <div class="header">
        <div class="container_header">
            <div class="imagem1">
                <img src="../assets/imagens/logo.svg" alt="" class="imagemfixa">
            </div>
            <div class="opcPrincipais">
                <a href="orcamento-cadastrado.html">Orçamentos</a>
                <a href="calculadora-cadastrado.html">Calculadora</a>
            </div>
            <a href="principal-cadastrado.html">Voltar</a>
        </div>
    </div>
    <div style="width: 100vw; display: flex; justify-content: center; margin-top: 10px;" id="div_titulo">
        
    </div>
    <div class="tudoCard" id="tudoCard">

    
      
    </div>
    <body onload="
    
    // validarSessao(), 
    exibirRefrigeradores(), 
    atualizacaoPeriodica()
    // autenticarLogado()
    ">

</html>
<script src="./js/alerta.js"></script>
<script src="./js/sessao.js"></script>
<script>

function exibirRefrigeradores() {
    estabelecimento = sessionStorage.nomeEstabelecimento;
    div_titulo.innerHTML = `
    <p class="refrigeradores">Refrigeradores do Estabelecimento<span style= 'color: #00FFFF; margin-left: 7px'>${estabelecimento}</span> </p>
    `
        var refrigeradores = JSON.parse(sessionStorage.getItem('Refrigeradores'));
            // console.log(refrigeradores);
            refrigeradores.forEach(item => {
            //   console.log(item);
                document.getElementById("tudoCard").innerHTML += `
                       <div class="card-refrigerador"  onclick="exibirPortas(${item.idRefrigerador})">
                        <div class="title-refrigerador">
                            <h1>Refrigerador ${item.idRefrigerador}</h1>
                            <h2>Local: ${item.localFisico}</h2>
                        </div>
                        <div class="desc-refrigerador">
                        <div class="temperatura">
                            <p id="temp_refrigerador_${item.idRefrigerador}">-°C</p>
                        </div>
                        <div class="cor-alerta" id="card_${item.idRefrigerador}"></div>
                    </div>
                    </div>
                        
                `
                // obterDadosRefrigerador(item.Refrigerador_id)
            });
    }

    function exibirPortas(idRefrigerador) {

                    var tag = 'div'
                    var texto = `

                    <div style="display: flex;">
                        <h1>Portas do Refrigerador ${idRefrigerador}
                            </h1>
                            <button class="card-btn" style="margin-top: 20px" onclick='fecharPortas(cardportarefrigerador.id)'>X</button>
                    
                            </div>
                            
                        

                    `
                    var id =  `cardportarefrigerador`
                    var classe = 'card-portas-refrigerador'
                    const card = document.getElementById('cardportarefrigerador');
                    if (card){
                        card.remove();
                    }
                    // Cria um novo elemento
                    var novoElemento = document.createElement(tag);
                        var porta_refrigeradores = JSON.parse(sessionStorage.getItem('PortasRefrigeradores'));
                        porta_refrigeradores.forEach(item => {
                        //   console.log(item);

                        if (item.fkRefrigerador == idRefrigerador){

                            texto += `
                            <div class="card-refrigerador1">
                                <div class="title-refrigerador">
                                    <h1>Porta ${item.idPorta}</h1>
                                    <h2>Produto Armazenado: ${item.produtoArmazenado}</h2>
                                    <h2>Tipo Abertura: ${item.tipoAbertura}</h2>
                                    
                                    </div>
                                    <div class="desc-portas">
                                        <div class="temperatura">
                <p id="abertura_porta_${item.idPorta}_refrigerador_${item.fkRefrigerador}" style = 'color: #00FFFF; font-size: 30px'>Aberturas:</p>
                                            </div>
                                            <div class="cor-alerta" id="card_${item.idPorta}"></div>
                                            </div>
                                            </div>
                                            
                                            `
                                        }
                            // obterDadosRefrigerador(item.Refrigerador_id)
                        });

                        
                    // Define o conteúdo de texto do novo elemento
                    if (texto) {
                        novoElemento.innerHTML = texto;
                    }

                    // Define o ID do novo elemento (opcional)
                    if (id) {
                        novoElemento.id = id;
                    }

                    // Adiciona uma classe ao novo elemento (opcional)
                    if (classe) {
                        novoElemento.classList.add(classe);
                    }

                    // Adiciona o novo elemento ao body (ou nesse caso, tudoCard)
                    document.getElementById('tudoCard').appendChild(novoElemento);
                



    
    }

    function fecharPortas(id){
        const teste = document.getElementById(id)
        teste.remove();
    }


    // window.onload = () => {
    // exibirRefrigeradoresDoUsuario();
    // }
    // function exibirRefrigeradoresDoUsuario() {
    //         var refrigeradores = JSON.parse(sessionStorage.getItem('Refrigeradores'));
    //         // console.log(refrigeradores);

    //         refrigeradores.forEach(item => {
    //           console.log(item);
    //             document.getElementById("tudoCard").innerHTML += `
    //                         <div class="cardRefri">
    //                             <p>Refrigerador ${item.Refrigerador_id}</p> 
    //                             <p id="temp_atual">SDLFJHSDKFJSDF</p>
    //                         </div>
    //             `
    //             obterDadosRefrigerador(item.Refrigerador_id)
    //         });
    //         // if (refrigeradores.length > 0) {
    //         //     // exibirAquario(aquarios[0].id)
    //         // }
    //     }
    
    
    //     function obterDadosGrafico(idRefrigerador) {
    
    //     // alterarTitulo(idAquario)
    
    // // if (proximaAtualizacao != undefined) {
    //     // clearTimeout(proximaAtualizacao);
    // // }
    
    // fetch(`/medidas_card/ultimas/${idRefrigerador}`, { cache: 'no-store' }).then(function (response) {
    //     if (response.ok) {
    //         response.json().then(function (resposta) {
    //             console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
    //             resposta.reverse();
    //             plotarCard(resposta, idRefrigerador);
    
    //         });
    //     } else {
    //         console.error('Nenhum dado encontrado ou erro na API');
    //     }
    // })
    //     .catch(function (error) {
    //         console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    //     });
    // }
    
    //     function exibirRefrigerador(idRefrigerador) {
    //         let todosOsGraficos = JSON.parse(sessionStorage.getItem('Refrigeradores'));
    
    //         for (i = 0; i < todosOsGraficos.length; i++) {
    //             // exibindo - ou não - o gráfico
    //             if (todosOsGraficos[i].Refrigerador_id != idRefrigerador) {
    //                 let elementoAtual = document.getElementById(`grafico${todosOsGraficos[i].Refrigerador_id}`)
    //                 if (elementoAtual.classList.contains("display-block")) {
    //                     elementoAtual.classList.remove("display-block")
                        
    //                   }
                  
    
    //                 elementoAtual.classList.add("display-none")
    
    //                 // alterando estilo do botão
    //                 let btnAtual = document.getElementById(`btnRefrigerador${todosOsGraficos[i].Refrigerador_id}`)
    //                 if (btnAtual.classList.contains("btn-pink")) {
    //                     btnAtual.classList.remove("btn-pink")
    //                 }
    
    //                 btnAtual.classList.add("btn-white")
    //             }
    //             if(todosOsGraficos[i].Refrigerador_id == idRefrigerador){
    
    //             titulo_refrigerador.innerHTML = `${todosOsGraficos[i].Local}`
    //             console.log(todosOsGraficos.Local);
    //             }  
    //         }
    
    //         // exibindo - ou não - o gráfico
    //         let graficoExibir = document.getElementById(`grafico${idRefrigerador}`)
    //         graficoExibir.classList.remove("display-none")
    //         graficoExibir.classList.add("display-block")
    
    //         let btnExibir = document.getElementById(`btnRefrigerador${idRefrigerador}`)
    //         btnExibir.classList.remove("btn-white")
    //         btnExibir.classList.add("btn-pink")
    //     }
    
    // function plotarGrafico(resposta, idAquario) {
    
    // console.log('iniciando plotagem do gráfico...');
    
    // // Criando estrutura para plotar gráfico - labels
    // let labels = [];
    
    // // Criando estrutura para plotar gráfico - dados
    // let dados = {
    //     labels: labels,
    //     datasets: [{
    //         label: 'Umidade',
    //         data: [],
    //         fill: false,
    //         borderColor: 'rgb(75, 192, 192)',
    //         tension: 0.1
    //     },
    //     {
    //         label: 'Temperatura',
    //         data: [],
    //         fill: false,
    //         borderColor: 'rgb(199, 52, 52)',
    //         tension: 0.1
    //     }]
    // };
    
    // console.log('----------------------------------------------')
    // console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
    // console.log(resposta)
    
    // // Inserindo valores recebidos em estrutura para plotar o gráfico
    // for (i = 0; i < resposta.length; i++) {
    //     var registro = resposta[i];
    //     labels.push(registro.momento_grafico);
    //     dados.datasets[0].data.push(registro.umidade);
    //     dados.datasets[1].data.push(registro.temperatura);
    // }
    
    // console.log('----------------------------------------------')
    // console.log('O gráfico será plotado com os respectivos valores:')
    // console.log('Labels:')
    // console.log(labels)
    // console.log('Dados:')
    // console.log(dados.datasets)
    // console.log('----------------------------------------------')
    
    // // Criando estrutura para plotar gráfico - config
    // const config = {
    //     type: 'line',
    //     data: dados,
    // };
    
    // // Adicionando gráfico criado em div na tela
    // let myChart = new Chart(
    //     document.getElementById(`myChartCanvas${idAquario}`),
    //     config
    // );
    
    // setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    // }
    
    // // containerchat.innerHTML += `
    // //                 <div id="grafico${item.id}" class="display-none">
    // //                     <h3 class="tituloGraficos">
    // //                         <span id="tituloAquario${item.id}">${item.descricao}</span>
    // //                     </h3>
    // //                     <div class="graph">
    // //                         <canvas id="myChartCanvas${item.id}"></canvas>
    // //                     </div>
    // //                     <div class="label-captura">
    // //                         <p id="avisoCaptura${item.id}" style="color: white"></p>
    // //                     </div>
    // //                 </div>
    // //             `
     
    </script>